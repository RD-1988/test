# Part C. Querying the World Bank API

1. The goal of this part of the assignment is to obtain country-level development indicators that may be related to lingustic fragmentation from the World Bank API. You can read the documentation and instructions [here](https://datahelpdesk.worldbank.org/knowledgebase/articles/898581-basic-api-call-structures).

Write a function that will take an indicator code (e.g. `SP.POP.TOTL`) as input, query the API and parse the JSON output, and then return a clean data frame where each row is a country. If you're not able to figure it out, you can also use the `WDI` package. Feel free to take a look at the code for some clues on how to query the API (see e.g. [here](https://github.com/vincentarelbundock/WDI/blob/master/R/WDI.R)). 

```{r}
library("WDI")
# library(reshape2)
library(tidyr)

# Write a function that will take an indicator code 
wbApi <- function(indicator, country, start, end){
  # query the API & parse the JSON output
  wbDataLong <- WDI(indicator = indicator, country = country, start = start, end = end, extra = FALSE, cache = NULL)
  # return a clean data frame where each row is a country
  wcDataWide <- spread(wbDataLong, year, indicator)
}
```


2. Using the function you just created, get country-level data on two metrics: GDP per capita and another metric that you consider could be correlated to language fractionalization. (See the Alesina et al paper for inspiration.)

```{r}
# import country code
countryCode <- pull(.data = country_index, var = 1)
countryCode["XKS"] <- "XKX"

# data.worldbank.org.cn
gdpPerCapita <- wbApi(indicator = "NY.GDP.PCAP.CD", start = 2018, end = 2018, country = c(countryCode)) #GDP per capita (current US$)
colnames(gdpPerCapita)[3:length(colnames(gdpPerCapita))] <- paste( "gdp", colnames(gdpPerCapita)[3:length(colnames(gdpPerCapita))], sep = "")
gdpPerCapita

# another metric that you consider could be correlated to language fractionalization
gnpPerCapita <- wbApi(indicator = "NY.GNP.PCAP.CD", start = 2018, end = 2018, country =  c(countryCode)) #GNI per capita, Atlas method (current US$)
colnames(gnpPerCapita)[3:length(colnames(gnpPerCapita))] <- paste("gnp", colnames(gnpPerCapita)[3:length(colnames(gnpPerCapita))], sep = "")
gnpPerCapita

# combine into a metrix
countryLevelData <- merge(gdpPerCapita, gnpPerCapita, by="country")
```

3. Merge this new country-level dataset with the dataset you created at the end of part B. As before, you may need to fix some of the country names to ensure that all countries can be merged.

```{r}
merge_my_metric <- my_metric
merge_my_metric$country_info <- gsub('.{1}$', '', merge_my_metric$country_info)
names(merge_my_metric)[1] <- "iso2c.x"
mergedData <- merge(merge_my_metric, countryLevelData, by= "iso2c.x")

# remove irrelevant line
finalData <- subset(mergedData, select = c("country", "index", "xls_index",  "gdp2018", "gnp2018"))
```

4. What can you learn about the relationship between language fractionalization and economic development from this new dataset? Can you replicate the findings in Tables 5 and 8 of the paper? Use any statistical or graphic analyses that you consider appropriate to answer this question.

```{r}
cor(finalData $gdp2018, finalData $index, use = "complete.obs")
cor(finalData $gnp2018, finalData $index, use = "complete.obs")
```
I replicate the findings from the paper. There is a very small correlation between language fractionalization and economics development from this new dataset.